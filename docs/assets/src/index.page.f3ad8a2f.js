import{d as ke,u as W,b as pe,f as Ce,c as l,g as o,a as s,i,e as Y,F,h as ye,S as H,P as we,j as fe,m as Pe,r as _e,t as a,s as ge,p as G,k as Te,M as be}from"../chunk-5b6e2b84.js";import{p as de}from"../chunk-b022e595.js";import{r as V,a as z,i as he,n as Ie,m as Be,E as ue,s as Ee,C as j}from"../chunk-db74a8e4.js";const Fe=(e,t)=>{const n=t.network.in,r=t.network.out,h=0,c=0,_=V(e.prices.net.gbIn,n??0,t.useFreeTier),p=V(e.prices.net.gbOut,r??0,t.useFreeTier),C=z(_,p),g=[],k=[];let S=ue;for(let b of t.containers){const m=e.prices.container.find(u=>(u.limit===1/0||g.filter($=>$.name===u.name).length<u.limit)&&u.memory>=b.memory&&(b.cpuType==="shared"?u.cpu>=b.cpu||u.cpu<1&&b.cpu===1:u.cpuType==="dedicated"&&u.cpu>=b.cpu)&&(t.useFreeTier?!0:!(u.limit&&he(u.cost))));if(m){const u=Ie(m.cost),$=[],x=[];let w=ue;for(let v of b.addons)if(v.type==="ssd"){const P=V(e.prices.storage.persistentSsd,v.size,t.useFreeTier);w=z(w,P),$.push({type:"ssd",size:v.size,desired:v,price:P})}else if(v.type==="ipv4"){const P=V(e.prices.staticIp,v.num,t.useFreeTier);w=z(w,P),$.push({type:"ipv4",num:v.num,desired:v,price:P})}else x.push(v);const D=z(u,w);g.push({name:m.name,num:1,cpu:m.cpu,cpuType:m.cpuType==="shared"?"shared":"dedicated",memory:m.memory,addons:$,unfulfilledAddons:x,desired:b,basePrice:u,addonsPrice:w,totalPrice:D}),S=z(S,D)}else k.push(b)}const y=z(C,S),T=t.useFreeTier?Be(e.prices.freeCreditsMonthly,y):ue,I=z(y,Ee(T,-1)),M=(t.useFreeTier?e.prices.freeCredits:0)/I.rate;return{desired:t,provider:e,totalPrice:y,adjustedTotalPrice:I,freeCreditsUsed:T,freeMonths:M,containers:{desired:t.containers,fulfilled:g,unfulfilled:k,totalPrice:S},network:{desired:t.network,netIn:n,netOut:r,unfulfilledNetIn:h,unfulfilledNetOut:c,netInPrice:_,netOutPrice:p,totalPrice:C}}},Me=a('<h2 class="text-xl m-2 mt-4 text-center">Summary</h2>'),De=a(`<p class="text-slate-700">Click providers' names to see a detailed cost breakdown below.</p>`),Oe=a('<h2 class="text-xl m-2 mt-4 text-center">Cost Breakdown</h2>'),ze=a('<p class="text-slate-700">Itemized breakdown of the prices summarized above. Quantities are rounded to nearest cent.</p>'),Ae=a(`<p class="text-slate-700 mb-4">Click a provider's name above to see detailed cost breakdowns here!</p>`),Le=a('<div class="ml-32 my-2 cursor-pointer"><div class="inline-block align-top w-28"></div><div class="list-decimal inline-block"><!#><!/> <!#><!/></div></div>'),je=a('<div class="my-4"><div class="inline-block align-top w-1/5 border-b border-b-slate-400"></div><ol class="inline-block w-4/5"><li class="border-b border-b-slate-400"></li><li><!#><!/> - Network egress (<!#><!/> GiB/mo)</li><!#><!/><!#><!/></ol></div>'),Ne=a("<li>Unable to fulfill desired container specification.</li>"),Ue=a("<ol></ol>"),Ge=a("<li>-<!#><!/> - Monthly free-tier credit</li>"),Re=a("<li><!#><!/> - <!#><!/> (cpu: <!#><!/>, mem: <!#><!/>)<!#><!/><!#><!/></li>"),Ye=a("<li><!#><!/> - <!#><!/></li>"),He=a('<select class="mx-2 text-black font-semibold bg-inherit border-b-slate-500 border-b"></select>'),Qe=a("<option></option>"),Xe=a('<input class="mx-2 text-black font-semibold border-b-slate-500 border-b" type="number">'),Ze=a('<button class="mx-2 hover:underline text-lime-700"></button>'),qe=a('<button class="mx-2 text-red-600 float-right">[X]</button>'),Je=a('<li class="py-2 clear-both">A container with:<!#><!/><ol class="ml-4"><li>A<!#><!/>CPU with<!#><!/>core<!#><!/> and<!#><!/>MB memory.</li><!#><!/><li class="clear-both"><!#><!/><!#><!/></li></ol></li>'),Ke=a('<li class="clear-both"><!#><!/><!#><!/></li>'),Ve=a("<li>Unknown addon type: <!#><!/></li>"),We=a("<div></div>"),et=a('<div class="my-2 text-slate-700"><ol class="mb-4"><!#><!/><!#><!/></ol><p>You expect to need<!#><!/>GB/mo network egress traffic across all containers. (None of the providers charge for incoming traffic.)</p><div class="p-4"><input type="checkbox" id="togglefreetier"><label class="select-none ml-1" for="togglefreetier">Include free-tier offerings in the estimation</label></div></div>'),tt=a("<p>Add container(s) to see estimated prices across a range of PaaS providers:</p>"),ut=()=>{const[e]=W(),t=Object.keys(de),n=pe(()=>t.map(c=>({providerId:c,provider:de[c],fulfilled:Fe(de[c],e.stack)}))),[r,h]=Ce({});return l(we,{page:"",get children(){return[l(ct,{}),o(Me),o(De),l(F,{get each(){return n()},children:c=>l(nt,ye(c,{get faded(){return Object.keys(r).length!==0&&!r[c.providerId]},onClick:()=>h(c.providerId,_=>_?void 0:!0)}))}),o(Oe),l(H,{get when(){return Object.keys(r).length>0},get fallback(){return o(Ae)},get children(){return[o(ze),l(F,{get each(){return n()},children:c=>l(H,{get when(){return r[c.providerId]},get children(){return l(lt,c)}})})]}})]}})},nt=e=>(()=>{const t=o(Le),n=t.firstChild,r=n.nextSibling,h=r.firstChild,[c,_]=s(h.nextSibling),p=c.nextSibling,C=p.nextSibling,[g,k]=s(C.nextSibling);return fe(t,"click",e.onClick,!0),i(n,()=>e.provider.name),i(r,l(j,{get value(){return e.fulfilled.adjustedTotalPrice}}),c,_),i(r,(()=>{const S=Pe(()=>e.fulfilled.freeMonths>0&&e.fulfilled.freeMonths!==1/0);return()=>S()&&`(${e.fulfilled.freeMonths.toFixed(1)} free months)`})(),g,k),Y(()=>t.classList.toggle("text-slate-400",!!e.faded)),_e(),t})(),lt=e=>(()=>{const t=o(je),n=t.firstChild,r=n.nextSibling,h=r.firstChild,c=h.nextSibling,_=c.firstChild,[p,C]=s(_.nextSibling),g=p.nextSibling,k=g.nextSibling,[S,y]=s(k.nextSibling);S.nextSibling;const T=c.nextSibling,[I,M]=s(T.nextSibling),b=I.nextSibling,[m,u]=s(b.nextSibling);return i(n,()=>e.provider.name),i(h,l(j,{get value(){return e.fulfilled.adjustedTotalPrice}})),i(c,l(j,{get value(){return e.fulfilled.network.netOutPrice}}),p,C),i(c,()=>e.fulfilled.network.netOut,S,y),i(r,l(F,{get each(){return e.fulfilled.containers.unfulfilled},children:$=>o(Ne)}),I,M),i(r,l(F,{get each(){return e.fulfilled.containers.fulfilled},children:$=>(()=>{const x=o(Re),w=x.firstChild,[D,v]=s(w.nextSibling),P=D.nextSibling,ee=P.nextSibling,[Q,X]=s(ee.nextSibling),te=Q.nextSibling,N=te.nextSibling,[Z,q]=s(N.nextSibling),ne=Z.nextSibling,le=ne.nextSibling,[J,ie]=s(le.nextSibling),d=J.nextSibling,U=d.nextSibling,[O,re]=s(U.nextSibling),K=O.nextSibling,[se,ce]=s(K.nextSibling);return i(x,l(j,{get value(){return $.basePrice}}),D,v),i(x,()=>$.name,Q,X),i(x,()=>$.cpu,Z,q),i(x,()=>$.memory>1024?`${$.memory/1024}gb`:`${$.memory}mb`,J,ie),i(x,l(H,{get when(){return $.addons},get children(){const E=o(Ue);return i(E,l(F,{get each(){return $.addons},children:B=>(()=>{const f=o(Ye),A=f.firstChild,[L,oe]=s(A.nextSibling),ae=L.nextSibling,xe=ae.nextSibling,[Se,ve]=s(xe.nextSibling);return i(f,l(j,{get value(){return B.price}}),L,oe),i(f,()=>B.type==="ipv4"?`${B.num} static IPv4 address${B.num===1?"":"es"}`:`${B.size} GiB persistent SSD`,Se,ve),f})()})),E}}),O,re),i(x,l(H,{get when(){return!he(e.fulfilled.freeCreditsUsed)},get children(){const E=o(Ge),B=E.firstChild,f=B.nextSibling,[A,L]=s(f.nextSibling);return A.nextSibling,i(E,l(j,{get value(){return e.fulfilled.freeCreditsUsed}}),A,L),E}}),se,ce),x})()}),m,u),t})(),it=e=>(()=>{const t=o(He);return t.addEventListener("change",n=>e.onChange(n.target.value)),i(t,l(F,{get each(){return e.options},children:n=>(()=>{const r=o(Qe);return r.value=n,i(r,n),Y(()=>r.selected=e.selected===n),r})()})),t})(),R=e=>(()=>{const t=o(Xe);return t.addEventListener("change",n=>e.onChange(parseInt(n.target.value,10))),Y(n=>{const r=!!e.wide,h=!e.wide,c=e.step,_=e.min??e.step??1;return r!==n._v$&&t.classList.toggle("w-16",n._v$=r),h!==n._v$2&&t.classList.toggle("w-12",n._v$2=h),c!==n._v$3&&ge(t,"step",n._v$3=c),_!==n._v$4&&ge(t,"min",n._v$4=_),n},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),Y(()=>t.value=e.value),t})(),$e=e=>(()=>{const t=o(Ze);return t.$$click=()=>e.onClick(),i(t,()=>e.children),_e(),t})(),me=e=>(()=>{const t=o(qe);return fe(t,"click",e.onClick,!0),_e(),t})(),rt=e=>{const[t,n]=W();return(()=>{const r=o(Je),h=r.firstChild,c=h.nextSibling,[_,p]=s(c.nextSibling),C=_.nextSibling,g=C.firstChild,k=g.firstChild,S=k.nextSibling,[y,T]=s(S.nextSibling),I=y.nextSibling,M=I.nextSibling,[b,m]=s(M.nextSibling),u=b.nextSibling,$=u.nextSibling,[x,w]=s($.nextSibling),D=x.nextSibling,v=D.nextSibling,[P,ee]=s(v.nextSibling);P.nextSibling;const Q=g.nextSibling,[X,te]=s(Q.nextSibling),N=X.nextSibling,Z=N.firstChild,[q,ne]=s(Z.nextSibling),le=q.nextSibling,[J,ie]=s(le.nextSibling);return i(r,l(me,{onClick:()=>n("stack","containers",G(d=>d.splice(e.index,1)))}),_,p),i(g,l(it,{options:["shared","dedicated"],get selected(){return e.container.cpuType},onChange:d=>n("stack","containers",e.index,"cpuType",d)}),y,T),i(g,l(R,{get value(){return e.container.cpu},onChange:d=>n("stack","containers",e.index,"cpu",d)}),b,m),i(g,()=>e.container.cpu===1?"":"s",x,w),i(g,l(R,{get value(){return e.container.memory},onChange:d=>n("stack","containers",e.index,"memory",d),wide:!0,step:256}),P,ee),i(C,l(F,{get each(){return e.container.addons},children:(d,U)=>(()=>{const O=o(Ke),re=O.firstChild,[K,se]=s(re.nextSibling),ce=K.nextSibling,[E,B]=s(ce.nextSibling);return i(O,l(Te,{get fallback(){return(()=>{const f=o(Ve),A=f.firstChild,L=A.nextSibling,[oe,ae]=s(L.nextSibling);return i(f,()=>d.type,oe,ae),f})()},get children(){return[l(be,{get when(){return d.type==="ssd"},get children(){return["An SSD with",l(R,{get value(){return d.size},onChange:f=>n("stack","containers",e.index,"addons",U(),"size",f)}),"GB."]}}),l(be,{get when(){return d.type==="ipv4"},get children(){return[l(R,{get value(){return d.num},onChange:f=>n("stack","containers",e.index,"addons",U(),"num",f)}),"static IPv4 address(es)."]}})]}}),K,se),i(O,l(me,{onClick:()=>n("stack","containers",e.index,"addons",G(f=>f.splice(U(),1)))}),E,B),O})()}),X,te),i(N,l(H,{get when(){return!e.container.addons.find(d=>d.type==="ipv4")},get children(){return l($e,{onClick:()=>n("stack","containers",e.index,"addons",G(d=>d.push({type:"ipv4",num:1}))),children:"[+IPv4]"})}}),q,ne),i(N,l($e,{onClick:()=>n("stack","containers",e.index,"addons",G(d=>d.push({type:"ssd",size:1}))),children:"[+SSD]"}),J,ie),r})()},st=()=>{const[e,t]=W();return(()=>{const n=o(We);return i(n,l($e,{onClick:()=>t("stack","containers",G(r=>r.push({cpu:1,cpuType:"shared",memory:256,addons:[],num:1}))),children:"[+Container]"})),n})()},ct=()=>{const[e,t]=W();return(()=>{const n=o(et),r=n.firstChild,h=r.firstChild,[c,_]=s(h.nextSibling),p=c.nextSibling,[C,g]=s(p.nextSibling),k=r.nextSibling,S=k.firstChild,y=S.nextSibling,[T,I]=s(y.nextSibling);T.nextSibling;const M=k.nextSibling,b=M.firstChild;return i(r,l(F,{get each(){return e.stack.containers},get fallback(){return o(tt)},children:(m,u)=>l(rt,{container:m,get index(){return u()}})}),c,_),i(r,l(st,{}),C,g),i(k,l(R,{get value(){return e.stack.network.out},onChange:m=>t("stack","network","out",m),min:0}),T,I),b.addEventListener("change",m=>t("stack","useFreeTier",Boolean(m.target.checked))),Y(()=>b.checked=e.stack.useFreeTier),n})()};ke(["click"]);export{ct as DesiredStackEditor,ut as Page};
